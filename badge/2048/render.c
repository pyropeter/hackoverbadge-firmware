#include <stdint.h>

#include "render.h"

static uint16_t const number_glyphs[][FIELD_SIZE] = {
  {
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0000111110000,
    0b0000111110000,
    0b0000000110000,
    0b0000000110000,
    0b0000000110000,
    0b0000111110000,
    0b0000111110000,
    0b0000110000000,
    0b0000110000000,
    0b0000111110000,
    0b0000111110000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0000110110000,
    0b0000110110000,
    0b0000110110000,
    0b0000110110000,
    0b0000111110000,
    0b0000111110000,
    0b0000000110000,
    0b0000000110000,
    0b0000000110000,
    0b0000000110000,
    0b0000000110000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0000111110000,
    0b0000111110000,
    0b0000110110000,
    0b0000110110000,
    0b0000111110000,
    0b0000110110000,
    0b0000110110000,
    0b0000110110000,
    0b0000111110000,
    0b0000111110000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0111101111100,
    0b0111101111100,
    0b0001101100000,
    0b0001101100000,
    0b0001101111100,
    0b0001101111100,
    0b0001101101100,
    0b0001101101100,
    0b0001101101100,
    0b0001101111100,
    0b0001101111100,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0011110111110,
    0b0011110111110,
    0b0000110000110,
    0b0000110000110,
    0b0000110000110,
    0b0011110111110,
    0b0011110111110,
    0b0000110110000,
    0b0000110110000,
    0b0011110111110,
    0b0011110111110,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0111110110110,
    0b0111110110110,
    0b0110000110110,
    0b0110000110110,
    0b0111110111110,
    0b0111110111110,
    0b0110110000110,
    0b0110110000110,
    0b0110110000110,
    0b0111110000110,
    0b0111110000110,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0000000011000,
    0b0000000001000,
    0b0000000001000,
    0b0000000001000,
    0b0000000001000,
    0b0000000000000,
    0b0001110111000,
    0b0000010101000,
    0b0001110111000,
    0b0001000101000,
    0b0001110111000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0000000111000,
    0b0000000001000,
    0b0000000111000,
    0b0000000100000,
    0b0000000111000,
    0b0000000000000,
    0b0001110111000,
    0b0001000100000,
    0b0001110111000,
    0b0000010101000,
    0b0001110111000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0000000111000,
    0b0000000100000,
    0b0000000111000,
    0b0000000001000,
    0b0000000111000,
    0b0000000000000,
    0b0000110111000,
    0b0000010001000,
    0b0000010111000,
    0b0000010100000,
    0b0000010111000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0000110111000,
    0b0000010101000,
    0b0000010101000,
    0b0000010101000,
    0b0000010111000,
    0b0000000000000,
    0b0001110101000,
    0b0000010101000,
    0b0001110111000,
    0b0001000001000,
    0b0001110001000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0001110111000,
    0b0000010101000,
    0b0001110101000,
    0b0001000101000,
    0b0001110111000,
    0b0000000000000,
    0b0001010111000,
    0b0001010101000,
    0b0001110111000,
    0b0000010101000,
    0b0000010111000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0001010111000,
    0b0001010101000,
    0b0001110101000,
    0b0000010101000,
    0b0000010111000,
    0b0000000000000,
    0b0001110111000,
    0b0001010100000,
    0b0001110111000,
    0b0000010101000,
    0b0001110111000,
    0b0000000000000
  },
  {
    0b0000000000000,
    0b0001110011000,
    0b0001010001000,
    0b0001110001000,
    0b0001010001000,
    0b0001110001000,
    0b0000000000000,
    0b0001110111000,
    0b0001010001000,
    0b0001110111000,
    0b0000010100000,
    0b0001110111000,
    0b0000000000000
  }
};

void show_frame(badge_framebuffer * fb) {
  for(uint8_t y = 10; y <= 10 + 14 * 4; y += 14) {
    for(uint8_t x = 20; x <= 20 + 55; x++)
      badge_framebuffer_pixel_on(fb, x, y);
  }

  for(uint8_t x = 20; x <= 20 + 4 * 14; x += 14) {
    for(uint8_t y = 10; y <= 10 + 14 * 4; y++)
      badge_framebuffer_pixel_on(fb, x, y);
  }

  badge_framebuffer_flush((badge_framebuffer const *) fb);
}

void show_grid(badge_framebuffer * fb, uint16_t grid[GRID_SIZE][GRID_SIZE]) {
  for(uint8_t x_grid = 0; x_grid < 4; x_grid++) {
    for(uint8_t y_grid = 0; y_grid < 4; y_grid++) {
	render_number(fb, grid[x_grid][y_grid], x_grid, y_grid);
    }
  }

  badge_framebuffer_flush((badge_framebuffer const *) fb);
}

void render_number(badge_framebuffer * fb, uint8_t number, uint8_t x_grid, uint8_t y_grid) {
  for(uint8_t y = 11 + y_grid * 15; y < 11 + y_grid * 15 + 13; y++) {
    for(uint8_t x = 21 + x_grid * 15; x < 21 + x_grid * 15 + 13; x++) {
      if((number_glyphs[number][(y - (11 + y_grid * 15))] >> (21 + x_grid * 15 + 12 - x)) & 1)
	 badge_framebuffer_pixel_on(fb, x - x_grid, y - y_grid);
      else
	 badge_framebuffer_pixel_off(fb, x - x_grid, y - y_grid);
    }
  }
};

void clear_field(badge_framebuffer * fb, uint8_t x_grid, uint8_t y_grid) {
  render_number(fb, 0, x_grid, y_grid);
  badge_framebuffer_flush((badge_framebuffer const *) fb);
}
